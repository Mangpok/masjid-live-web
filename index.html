<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ô‡∏≤‡∏ã‡∏¥‡∏Å‡∏≤‡∏ö‡∏π - ‡∏°‡∏±‡∏™‡∏¢‡∏¥‡∏î‡∏≠‡∏±‡∏•‡∏Æ‡∏µ‡∏•‡∏≤‡∏•‡∏µ‡∏¢‡∏∞‡∏´‡πå</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans Thai', sans-serif;
            /* Updated to a purple gradient */
            background: linear-gradient(to bottom right, #f3e8ff, #e9d5ff);
        }
        /* Custom styles to match the card design */
        .card-container {
            width: 100%;
            padding-top: 56.25%; /* 16:9 Aspect Ratio */
            position: relative;
        }
        .card-content {
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 2rem;
        }
        .chart-container {
            position: relative;
            width: 100%;
            height: 100%;
        }
        .chart-text-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }
        .gradient-text {
            /* Updated to a purple gradient */
            background: linear-gradient(to right, #7c3aed, #d8b4fe);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .text-shadow {
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="bg-stone-50 text-stone-800">

    <div class="container mx-auto p-4 md:p-8 max-w-4xl min-h-screen flex items-center justify-center">

        <main class="w-full">
            <section id="progress" class="bg-white rounded-2xl shadow-xl relative">
                <!-- Language Switcher -->
                <div class="absolute top-4 right-4 flex space-x-2 z-10">
                    <button onclick="setLanguage('th')" class="p-2 rounded-full hover:bg-stone-200 transition-colors duration-200" title="‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢">
                        üáπüá≠
                    </button>
                    <button onclick="setLanguage('ms')" class="p-2 rounded-full hover:bg-stone-200 transition-colors duration-200" title="Bahasa Melayu">
                        üá≤üáæ
                    </button>
                </div>
                
                <div class="card-container">
                    <div class="card-content">
                        <div class="w-full text-center">
                            <h2 class="text-2xl md:text-3xl font-bold text-violet-950 mb-2" data-i18n="progress_heading">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏¢‡∏≠‡∏î‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ</h2>
                            <p class="text-sm md:text-base text-violet-700 mb-6" data-i18n="progress_description">‡∏£‡πà‡∏ß‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏ï‡πá‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ 3,000,000 ‡∏ö‡∏≤‡∏ó ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡πâ‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏≠‡∏±‡∏•‡∏•‡∏≠‡∏Æ‡∏∫‡πÉ‡∏´‡πâ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</p>
                        </div>
                        
                        <div class="flex flex-col md:flex-row items-center justify-center w-full max-w-2xl space-y-8 md:space-y-0 md:space-x-8">
                            <!-- Left Section: Chart -->
                            <div class="w-2/3 md:w-1/2 flex items-center justify-center">
                                <div class="chart-container relative h-48 w-48 md:h-64 md:w-64">
                                    <canvas id="donationChart"></canvas>
                                    <div class="chart-text-overlay">
                                        <span id="percentageText" class="text-3xl md:text-5xl font-bold gradient-text">...%</span>
                                        <span class="block text-sm md:text-base text-violet-700" data-i18n="donation_label">‡∏¢‡∏≠‡∏î‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ</span>
                                        <span id="currentTimeText" class="block text-xs text-violet-400 mt-1"></span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Right Section: Donation Info -->
                            <div class="w-full md:w-1/2 text-center md:text-left">
                                <p class="text-violet-700 text-lg">
                                    <span data-i18n="latest_amount_label" class="font-bold text-violet-950">‡∏¢‡∏≠‡∏î‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: </span>
                                    <span id="currentAmountText" class="text-lg font-bold text-amber-600">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</span>
                                </p>
                                <!-- The goal text is now a single element for easier translation -->
                                <p class="text-violet-700" data-i18n="goal_from"></p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <footer class="text-center absolute bottom-4 w-full text-violet-700">
            <p data-i18n="footer_message" class="text-sm md:text-base">"‡∏ú‡∏•‡∏ö‡∏∏‡∏ç‡∏ó‡∏µ‡πà‡∏ó‡πà‡∏≤‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ ‡∏Ñ‡∏∑‡∏≠‡∏ö‡πâ‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏ó‡πà‡∏≤‡∏ô‡πÉ‡∏ô‡∏≠‡∏≤‡∏Ñ‡∏¥‡πÄ‡∏£‡∏≤‡∏∞‡∏´‡πå"</p>
        </footer>
    </div>

    <script>
        // Self-invoking function to encapsulate all the code
        (async function() {
            const donationGoal = 3000000;
            const currentTimeText = document.getElementById('currentTimeText');
            const percentageText = document.getElementById('percentageText');
            const currentAmountText = document.getElementById('currentAmountText');
            let currentLang = 'th';
            
            // Translation data, updated to include full goal text
            const translations = {
                th: {
                    progress_heading: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏¢‡∏≠‡∏î‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ',
                    progress_description: '‡∏£‡πà‡∏ß‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏ï‡πá‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ 3,000,000 ‡∏ö‡∏≤‡∏ó ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡πâ‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏≠‡∏±‡∏•‡∏•‡∏≠‡∏Æ‡∏∫‡πÉ‡∏´‡πâ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                    donation_label: '‡∏¢‡∏≠‡∏î‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ',
                    latest_amount_label: '‡∏¢‡∏≠‡∏î‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î:',
                    goal_from: '‡∏à‡∏≤‡∏Å‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ <span class="font-bold">3,000,000</span> ‡∏ö‡∏≤‡∏ó',
                    footer_message: '\"‡∏ú‡∏•‡∏ö‡∏∏‡∏ç‡∏ó‡∏µ‡πà‡∏ó‡πà‡∏≤‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ ‡∏Ñ‡∏∑‡∏≠‡∏ö‡πâ‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏ó‡πà‡∏≤‡∏ô‡πÉ‡∏ô‡∏≠‡∏≤‡∏Ñ‡∏¥‡πÄ‡∏£‡∏≤‡∏∞‡∏´‡πå\"',
                },
                ms: {
                    progress_heading: 'Kemajuan Dana Sumbangan',
                    progress_description: 'Sertai kami dalam mencapai sasaran 3,000,000 Baht untuk menyelesaikan Rumah Allah.',
                    donation_label: 'Sumbangan',
                    latest_amount_label: 'Jumlah Sumbangan Terkini:',
                    goal_from: 'Dari sasaran <span class="font-bold">3,000,000</span> Baht',
                    footer_message: '\"Pahala yang anda bina hari ini, adalah rumah anda di Akhirat.\"'
                }
            };
            
            // Create the Doughnut Chart
            const ctx = document.getElementById('donationChart').getContext('2d');
            const donationChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    datasets: [{
                        data: [0, donationGoal],
                        /* Updated chart colors for a purple theme */
                        backgroundColor: ['#7c3aed', '#d1d5db'],
                        borderWidth: 0,
                        borderRadius: 10,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '80%',
                    plugins: {
                        tooltip: { enabled: false }
                    },
                    animation: {
                        animateScale: true,
                        animateRotate: true
                    }
                }
            });

            // Function to update the chart and text
            function updateChart(amount) {
                const percentage = Math.min(100, (amount / donationGoal) * 100);
                
                donationChart.data.datasets[0].data[0] = amount;
                donationChart.data.datasets[0].data[1] = Math.max(0, donationGoal - amount);
                donationChart.update();
                
                percentageText.textContent = `${percentage.toFixed(1)}%`;
                currentAmountText.textContent = amount.toLocaleString('th-TH') + ' ‡∏ö‡∏≤‡∏ó';
            }

            // Function to change language
            window.setLanguage = function(lang) {
                currentLang = lang;
                const elements = document.querySelectorAll('[data-i18n]');
                elements.forEach(el => {
                    const key = el.getAttribute('data-i18n');
                    if (translations[lang][key]) {
                        el.innerHTML = translations[lang][key]; // Use innerHTML to render the bolded number
                    }
                });
                updateClock();
            };

            // Function to update the current time
            function updateClock() {
                const now = new Date();
                const options = { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' };
                let locale = (currentLang === 'ms') ? 'ms-MY' : 'th-TH';
                const formattedTime = now.toLocaleDateString(locale, options);
                currentTimeText.textContent = `${formattedTime}`;
            }

            // Main function to fetch data from Google Sheet
            async function fetchSheet() {
                const url = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSdxUvZTFoCoJODdiGXDsofsY8Dfl27i59rtjyKhFeLw4U3viAqbWrVGvgn9HHu6dpT3ngUAzooaRnv/pub?gid=0&single=true&output=csv';
                
                try {
                    const response = await fetch(url);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const csvText = await response.text();
                    
                    const rows = csvText.trim().split('\n').filter(row => row.trim());
                    let latestAmount = 0;
                    
                    for (let i = rows.length - 1; i >= 0; i--) {
                        const row = rows[i];
                        const value = parseFloat(row.split(',')[0]);
                        if (!isNaN(value)) {
                            latestAmount = value;
                            break;
                        }
                    }

                    updateChart(latestAmount);

                } catch (error) {
                    console.error('An error occurred while fetching data:', error);
                    updateChart(0);
                }
            }

            // Start the application when the window loads
            window.onload = function() {
                setLanguage('th');
                fetchSheet();
                setInterval(updateClock, 1000);
                setInterval(fetchSheet, 1000 * 10);
            }
        })();
    </script>
</body>
</html>
